{"componentChunkName":"component---src-templates-post-jsx","path":"/phase2/","result":{"data":{"site":{"siteMetadata":{"title":"hyungkishin.blog"}},"markdownRemark":{"id":"1e90878c-3b63-5ee1-82dd-7c84ca638419","excerpt":"들어가며 AMP 페이지가 동작하지 않았던 이유는 NextJs 에서 지원하지 않은 Router 방식임을 확인.\nPages 디렉토리를 생성후, 하위에 amp 전용 페이지를 두는것으로 진행하기로 했다. 기사 본문의 내용은 기자님들이 별도 도메인에서 Editor로 작성한 본문이 string 형태로 DB 에 적재되니 응답 string 을 dom 으로 뿌려주면 되는…","html":"<h2>들어가며</h2>\n<p>AMP 페이지가 동작하지 않았던 이유는 NextJs 에서 지원하지 않은 Router 방식임을 확인.\nPages 디렉토리를 생성후, 하위에 amp 전용 페이지를 두는것으로 진행하기로 했다.</p>\n<p>기사 본문의 내용은 기자님들이 별도 도메인에서 Editor로 작성한 본문이 string 형태로 DB 에 적재되니 응답 string 을 dom 으로 뿌려주면 되는 문제.</p>\n<p>AMP(Accelerated Mobile Pages)는 빠른 모바일 페이지 로딩을 위해 구글이 주도한 프레임워크로, <strong>강력한 성능을 얻는 대신 엄격한 제약</strong>을 동반한다.</p>\n<p>Next.js에서도 AMP를 적용하려면 이 제약을 그대로 수용해야 하며, <strong>페이지 구조, 스타일링, JS 사용 방식 등에서 별도의 대응이 필요하다.</strong></p>\n<p>Next.js에서 AMP를 적용할 때도 이러한 제한이 그대로 적용된다.</p>\n<p>시작 하기전에 기합 넣고 !</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 543px; '>\n      <a class='gatsby-resp-image-link' href='/static/48433615ed04eda934c72cb00342564f/10880/img_3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADN0lEQVR42lWTe2zTVRTHF+M/JmpUCPgiog5BURGN84WaiIuGxAQjCfuHmSxRo/KPiBJjZCRkxoWqY26z0I0+1sfWJ3UbjVsHzNp1XVv63opdx5xCwkaGMszW9fHx/n7tJp7k3pt7cu/nfM+551bks1miZhMX41EkKxQKFItFeZXslMPOtq1PUHn/3VTeswZNWyvL9ttZNx7FITJul7wvijsV4i6XgwGuZtIlZz5PXgzJpiczbF6/jlV33sbD6+5l7R23UvPWjhXgTDpFwtlNqKOZuYmU7KuQptlkgkl3P9nr87Izt7Qkr6PDXqo2PMTOqqe5b/Vd3HLzTVS/sk0OKmVRLGdxKXaOpFlNdv5aCXglPc75kxb+9PtZmJ+XD0v2eyZD3RuvM1j/OY0fvMv+XTto/ORjkUGpLPlcToYWxD4llGbcfSXg4t9/kTCpRBQDYz0/M3s+TX4pK0PHPWcZaWsgqlYwLs5MuFzMTf1RyllSWQ4+MxYnpldSsVz8C0MD+Np+IG7tJdZ1kpTLzcRpD9NeHwmbmVFNOwGTDZ/aiF9v5lJ6gmuXZ+Txz9xV0kMeoqbu/4CzU1MMq3TEup2E9BaCOlFsnZmwyU7S3ktQ+CLdDhKOPs4ZrES6HISMFsJddtElDvwaI0HhXwFejCcJaLoI6yz8ekyNVyuAnVaGW9WMGmxClY2RThvhDp1QqSdi6SFh7xGBzATE+EWlZei4WmqbUh2K8uNkGOsdwNt8FP+BD4kc+oJI7TsEWn5k9MCnhBrrCdftJnb4K4JqHVGjCNihx3tCT++RJgHU3AAsK80uLnB652761q7Cs/c5kvve5EztS6TqXmRwywM4X9iE4cmNtG99Fk/Tt3jaO2V1IftPXJm8cANQaoPsovxDDHtqaKtczcHtr6F97CkUmzehra3j2IPr+f7RNShefhxl1SNoP9uPV6iKn+pfefX/AQv5nOz3Kfeh3H47TR/t5etXq3lvy/MYGw7SuWcjX1Zv4Oj7b9NU8wya+sN4lCeIu0rA3MJ1ASz/XblBlzt/eorBHicjRjP9rSqc37WIBzNibmjE+o0Cn9aK40gzAy3HOdOiIlYGFrKL/AulgzumdJ2KoQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='가보자고' title='' src='/static/48433615ed04eda934c72cb00342564f/10880/img_3.png' srcset='/static/48433615ed04eda934c72cb00342564f/e7570/img_3.png 170w,\n/static/48433615ed04eda934c72cb00342564f/f46e7/img_3.png 340w,\n/static/48433615ed04eda934c72cb00342564f/10880/img_3.png 543w' sizes='(max-width: 543px) 100vw, 543px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>가보자고</figcaption>\n  </figure></p>\n<hr>\n<h2>TODO LIST 체크</h2>\n<ul>\n<li>AMP 페이지 는 총 N Phase 로 배포\n<ul>\n<li>( 우선 amp 가 존재 하는것을 mvp 목표로 배포 ! )</li>\n</ul>\n</li>\n<li>Pages Router 기반의 디렉토리 구조 설계</li>\n<li>AMP 대상 페이지 컴포넌트 설계</li>\n<li>middleware.ts 에서 /amp 로 시작하는 URL을 감지하여, 해당 페이지를 AMP 페이지로 리다이렉트 하도록 설정</li>\n<li>스타일링 ( GPT 의 도움으로 스피드하게 해결 )</li>\n<li>본문내용 api call 이후 제약 태그 -> amp 태그로 변환 util 만들기</li>\n<li>SEO 메타 태그 ( 손으로 일일히 해도 되지만 AI 이용해서 검수정도로만 빨리 ! )</li>\n</ul>\n<h2>되짚고 넘어가는 제약 사항 ⚠️</h2>\n<p>AMP는 일반적인 React 환경과 달리 다음과 같은 제한이 있다</p>\n<p>☝️. <strong>React Hook 사용 제한</strong></p>\n<ul>\n<li><code class=\"language-text\">useEffect</code>, <code class=\"language-text\">useState</code> 등 hook 기반 로직 사용 불가</li>\n</ul>\n<p>✌️. <strong>Sass/SCSS 등 외부 스타일 방식 제한</strong></p>\n<ul>\n<li>모든 스타일은 inline 또는 제한된 CSS 내에서 처리해야 함</li>\n</ul>\n<p>🫰. <strong>일반 script 태그 사용 불가</strong></p>\n<ul>\n<li><code class=\"language-text\">&lt;script></code> 태그 자체를 금지하며, JS는 <code class=\"language-text\">amp-script</code>로 제한적으로만 허용됨</li>\n</ul>\n<blockquote>\n<p>전체 AMP 검증은 <a href=\"https://validator.ampproject.org/\">AMP Validator</a> 를 통해 실시간 확인 가능</p>\n</blockquote>\n<hr>\n<h2>디렉팅 구조 전략 🗂️</h2>\n<p>pages 디렉토리 를 기반으로 amp 디렉토리를 생성하고, 하위에 slug 페이지를 작성한다.</p>\n<blockquote>\n<p>🔖 slug 란 ?</p>\n<ul>\n<li>ex ) /news/2025/04/17/기사제목</li>\n<li>URL의 일부를 사람이 읽기 좋고 검색엔진 친화적으로 만든 문자열</li>\n</ul>\n</blockquote>\n<p>middleware.ts 에서 /amp 로 시작하는 URL을 감지하여, 해당 페이지를 AMP 페이지로 리다이렉트 하도록 설정.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 363px; '>\n      <a class='gatsby-resp-image-link' href='/static/2a116434e1b7aa72d000971ee8d1627a/6ddef/img.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 133.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEMUlEQVR42pVVy05bVxTl16oOOqmiTjpJ1VGlDvoNldqklSpViqKmijJoiMEhxAaSFFzAgMFvDLaxsfHFYF+/39fXFz+vX9de2ecYRaEQcAZHfuhonbX2XnvtmXG/iVFfxaDXA0YaxgMV42EHGNNv+hz3W591ZjAaIHXqxMn2LxD8a1DKCbQvJJRyCdSrRWDQ/kxAaAh53qLju4+85R5S4VW4HU6svjPi2H/AAbVuA6Nec0rAoYpaKQm/cwl2sw61ShKdfgea1sOQgNglaCo/4ynYzrCXiQaUWhXZTBrl+ClCTx5SCdYgZ2MYdC7QqBbQkIsYqBdAvz0FIL1eLaZgd+7CYtRD/fFrSPe/gPjuJaxuO/56/Ag63T/Ip+P8rtZt3g2oVPLIpmNoEZvg6lucb6xCEk85K6WSQ6NWIhOQ9FHvVukTwFGXapfFWSSErBjAie0PxE+3USuLaCkVlPMJ+p5DNnmORCwCtSHzZo16twDK5QxcTjv2zAZI1m8gmr5ExD1L/7nx7NnfMLxewGs6RsMrxKNhqnv/RulXJWdFdDsyokELkhELpFyUS2QP8jPu0xC0brXQJUOyDtVJPBdQSoUR2fkNYmgTdbJQIiYgcRZGKi4gkzjjnry7y1xyFg67FdatJVQc3yK3/dVEsssDvX4Wc3OzeLNsQK9Vu3V6rklW2zJ8bhPi4UvJGpPc550dTW3sS8msy3kxiLj1AaK+FSilGEIBL1yOPRqo+nSj97HkfbcTbuu/UDzfQXbew7l3jkuen3+OC6nwYa6nmhRFIsmUML2ugqDnPyQEGzGkyaA0ovZOuk1dZrE2NcPIsR+R0BGe6/TY2tpBJhmjcYtR6ngQjQQQDhxSWYL0fp3YfgKQpwlJ6TZlskUUmxsm/PnoMX7+9SHW103w+/axbFyAfv4F5vUvsLm+xu9+kuHHP1jqdCldvAcuOGy7vFH5dILSvI92owZtQObGiGQPMNa6dwOygrMaKTS/AnX8NGhFcvsHHFt+RzbmRvxMgG3PTAG8h7RIlhq2r03NFUA27DzKShn4Dj3wujchH/6EC8/3iPkN5AIPts1reLNioHr7OKDWZXZq3gJ46ckUyz5q1vFJCP5wCE2ZbDOmJTYeTiQPVX4XXHrzA+j/ACcmZxY6cFkhS0UYhSIMkQJ6vTaslg0sLuqJpYlk78JEuem0WehdtnMme+cGwC4HPPK6oNYlOMUCbPEcNauBmBCEw7qD46MD2opJRE8CVEuBWNLaHbKd07oZkHlSZEXHEOFCGSeFCsVfk0I2C5Us0+8o6DSqFL5lCguZ1kcalUKK1o1yFZBbh5Z7hxI54HMjkxahC6b5KVfLWKDUeUWSzRtrWKHkMRoW8PTpEx66y0uLONx3XAfkh4w+pDQeUQejJQlCUeKWYhtwQCwYE8ZMI0UqMR0Se7Z7GMP3WZvKk7d5X0gAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='디렉토리 뼈대' title='' src='/static/2a116434e1b7aa72d000971ee8d1627a/6ddef/img.png' srcset='/static/2a116434e1b7aa72d000971ee8d1627a/e7570/img.png 170w,\n/static/2a116434e1b7aa72d000971ee8d1627a/f46e7/img.png 340w,\n/static/2a116434e1b7aa72d000971ee8d1627a/6ddef/img.png 363w' sizes='(max-width: 363px) 100vw, 363px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>디렉토리 뼈대</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> \n📁 src\n|── components                     \n    ├── amp                        # amp 페이지 내 공통컴포넌트 ( Header, Body, Footer 등 재사용 컴포넌트들 쭉쭉 넣어주고 ~ )\n    |... 원래 있던 친구들 내비두고 ~\n├── pages                         \n│   ├── amp                        # AMP 페이지 전용 디렉토리\n│   │   └── [slug].tsx             # section 카테고리별 디렉토리\n|   |     └── [depth1].tsx         # amp depth 1 본문 페이지\n|   |         └── [depth2].tsx     # amp depth 2 본문 페이지\n|   |             └── [depth3].tsx # amp depth 3 본문 페이지</code></pre></div>\n<p>이렇게 되면 사실상 <strong>사용자 관점</strong> 에서 보이는 기사 뷰 페이지는 2벌이다.</p>\n<ul>\n<li>일반 페이지 [ PC / MO ] &#x3C;-- 다행이 반응형으로 통합되어 있어서 아멘...</li>\n<li>AMP 페이지 ( depth 별 )</li>\n</ul>\n<p>기존 기사 본문 URL 구조는 <strong>slug url</strong> 형식으로 되어있으니 amp 페이지로 유입될 경우 본문에 해당되는 amp 페이지로 redirect 해주면 된다\npages 만 UI 뼈대를 만든 후 공통화 컴포넌트화 시키면 되겠다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 335px; '>\n      <a class='gatsby-resp-image-link' href='/static/1287d9388ab92c89f022c3e02880814b/56823/img_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 175.8823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD8klEQVR42p1Wy1LiQBT1v93O7HTKKRfuXIN7q3wsFEsEBOURHgmoJcpT3qAIgXCnz+106KCOzHTVKULSfXL79L3nZmM0HFEoFKJ8Pk+5XM5DJpOhVCq1FjA3HA7TcDikjXarLQjy1Ol0mLRUKpFpWdTvDwjDcRyBBS341xG/C4mFxHw+53mFQoEajQZtdDqS8O3tjSqVCtXrdarVavx/ISbOZjNyxCJHI3QUKa5dQtM0qdlsgrBD2WzWi0YNvH31v7znEq5G6CMUmpGKRkUiJtu2Tel0mp6fn6larXLUgnoNQjdCPJRbchAS2VObDoIHtPN7h7a2tujHj58ekdJREZoFl7DdFoSGSzibe1tVGI/H1Ov1qPXywgvUtr+JMOdp6EWgQR+rz5TOPkLkEcZkMqGp0M22pzQV251Opx4mE/E7kffxXMLmNRi5fE4SdjtdOjw8pLu7O85D5NO/AGuw9uTkhFqtlowQJ4mHkUiE4vH42kgkEnR1dcU5CNSR2L1en2KxGL/p/f1dpMaYD2IdYD7KDQGZplspvX6fItEYl5wS/atDUIemD5wyS5UvSA2REtFolIrFIlLPq138QnR/tZCWVgs3+WdsJpCMCfsiQkW4NANJcnx8TIFggAKBIAWDEqGLC1+Kobo+EMYEofUJISYmk0k6Ojqi/f192tvbo8TNjdyqKs9Vwp4boSUsy3Ezn0lRhguHbQsD28chSLI5EzriOfIShSHtS9Pwq0P5biAAJLWP8Frk1O3tLTsKvLBadcHX6l5VXrv/GcI7y+UyXV/HRdpYkrDdbrMGmAy9DMP4AJSmgn4fLoU1IMehch5KwjwLiv6QE5OyGrAVyIHygs6KCEAgWIO1IKzXG9K+DONzx8ZAiZ2dnTGwvVWd1XVB+GGD/VDUMt40Go2o/PQktapURX+RWqFeQXZ5Gebo0HPQe5SmT2IN1lq6hnmxrW63y8TYloJpmfTw8MCRPT4+0v39PZuAPgdrcLCehiCCsChwRKD3ZgBaQRJD000BNQwNsb5oFZfmgDxEL4aGKCXkFjCbzzih0RpwX3+mAINFIP5aFvZVLJa4D3ttwFlWib+1KtdxK2hmc5YsS89zG8vXoHCNt+OUB+IrAgeELSlCvdXK7RfkKastQ4OlfclONhwMaHNzk7Z/bTN2d3fp9fXVLTmH5+uEPvvCickta21ULIIhIC3Q5Gu1OhOQZra6H3LasH2xhkW5Zddt5pqN6Z8mPggd8THwV4P9H7eBfXlbRh6mU2nKGBm6EVWhvvmSnF8Sqc+uxS9yF4cG00BATb30MKCX3tzXgTJdVBBrOBgM6fT0lN+CjF/3q1VHOp2h89A5Qb4/BN0oGqAqsdsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='기사 본문 상단 구조' title='' src='/static/1287d9388ab92c89f022c3e02880814b/56823/img_1.png' srcset='/static/1287d9388ab92c89f022c3e02880814b/e7570/img_1.png 170w,\n/static/1287d9388ab92c89f022c3e02880814b/56823/img_1.png 335w' sizes='(max-width: 335px) 100vw, 335px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>기사 본문 상단 구조</figcaption>\n  </figure></p>\n<blockquote>\n<p>AMP는 제약은 많지만, 뉴스 도메인에선 여전히 유의미하다</p>\n<p>React hook이나 script 사용은 어렵지만 기본 콘텐츠 위주 뉴스 페이지엔 큰 무리는 없다</p>\n<p>middleware.ts + slug 기반으로 AMP 라우팅 처리하면 깔끔하게 대응 가능</p>\n<p>AMP 페이지는 별도로 구성하되, 디자인/구조는 최대한 기존과 일치시키는 전략이 효과적이다</p>\n</blockquote>\n<h2>기사 본문에서 amp 태그로 변환하는 util 함수 만들기</h2>\n<ul>\n<li>일반 HTML 태그는 사용 불가, AMP 전용 태그만 사용 가능</li>\n<li>예를 들어, <code class=\"language-text\">&lt;img></code> 태그는 <code class=\"language-text\">&lt;amp-img></code>로 대체해야 하며, <code class=\"language-text\">&lt;script></code> 태그는 <code class=\"language-text\">&lt;amp-script></code>로 대체해야 한다</li>\n<li><code class=\"language-text\">&lt;style amp-custom></code> 태그에는 <strong>최대 50KB까지만</strong> CSS 작성 가능</li>\n<li>애니메이션 전용으로 허용된 <code class=\"language-text\">&lt;style amp-keyframes></code>는 <strong>최대 500KB까지</strong> 허용되지만,\n이는 <code class=\"language-text\">&lt;body></code> 하단에만 위치할 수 있고, 오직 키프레임 규칙만 작성 가능하다</li>\n<li>JS 이벤트 핸들러 제거 , javascript: 링크 제거</li>\n<li>허용되지 않는 태그 하위 호환\n<ul>\n<li>font, area, form</li>\n</ul>\n</li>\n</ul>\n<p>👉 <strong>총 CSS + 인라인 스타일 합산이 75KB를 넘지 않도록</strong> 주의해야 한다 - <a href=\"https://amp.dev/documentation/guides-and-tutorials/learn/spec/amphtml\"> 관련 공식문서 </a></p>\n<hr>\n<h2>⚡️ 대략 적인 AMP 페이지 구조 ( 보여줄 수 없어서 추상적으로 대체 )</h2>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">⚡</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 공통 대상 Header --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,minimum-scale=1,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>canonical<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>원본 URL 잘 집어넣어야 합니다.<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>amp-google-client-id-api<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>googleanalytics<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    \n    <span class=\"token comment\">&lt;!--  공통 대상 : Style  --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">amp-custom</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n      <span class=\"token comment\">/* AMP 전용 CSS 들어올 자리 ( 용량 50KB 안넘기게 살살 다뤄줘 ) */</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n    \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    \n    <span class=\"token comment\">&lt;!--  공통 대상 : 뉴스 기사 Body --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token comment\">&lt;!--  공통 대상 : 예쁘게 컴포넌트 화 --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>article</span><span class=\"token punctuation\">></span></span>\n        기사 본문이 들어갈 자리\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>article</span><span class=\"token punctuation\">></span></span>\n      \n      <span class=\"token comment\">&lt;!--  갖가지 광고 예쁘게 공통으로 말아 --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ad</span><span class=\"token punctuation\">></span></span>\n        광고 들어갈 자리 Lazy Load 적용 대상\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ad</span><span class=\"token punctuation\">></span></span>\n      \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span>\n    \n    <span class=\"token comment\">&lt;!--  공통 대상 : footer 야 뭐...  --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>footer</span><span class=\"token punctuation\">></span></span>푸터 들어갈 자리<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>footer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<hr>\n<h2>AMP 규칙에 맞는 Style</h2>\n<p>Amp 용으로 style 잡는게 좀 까다로웠다 ( sass 방식이 왜 안돼 ... 하나하나 분석하다가 이건 도저히 아니다 싶었다. )</p>\n<p>AMP는 <code class=\"language-text\">&lt;style amp-custom></code> 단 하나만 허용</p>\n<ul>\n<li>모든 사용자 정의 스타일은 <code class=\"language-text\">&lt;head></code> 안의 <code class=\"language-text\">&lt;style amp-custom></code> 안에 작성해야 함.</li>\n<li><code class=\"language-text\">&lt;style></code> 태그가 두 개 이상 있으면 AMP 유효성 검사에서 실패. ( 별 ... )</li>\n<li>총 CSS 용량은 75KB 이하</li>\n<li>CSS 속성은 inline 스타일로 작성해야 함. ( CSS-in-JS 방식은 사용 불가 )\n<ul>\n<li><code class=\"language-text\">&lt;style amp-custom></code> 내부 전체 CSS 크기 합이 75KB (75,000 bytes)를 넘으면 안 됨.</li>\n</ul>\n</li>\n<li>초과 시 AMP validation 실패는 곧 페이지 노출 불가로 이어진다.</li>\n</ul>\n<p>미지원 CSS 속성/기능</p>\n<ul>\n<li>@import 사용 불가</li>\n<li>!important 사용 불가</li>\n<li>position: fixed는 예외적으로 일부 AMP 컴포넌트에서만 허용 (ex. <amp-sidebar>)</li>\n<li>animation, keyframes는 제한적으로만 허용됨</li>\n<li>filter, backdrop-filter, mix-blend-mode 등 일부 CSS 속성 사용 불가.</li>\n</ul>\n<p>AMP 구성요소의 스타일링</p>\n<ul>\n<li><code class=\"language-text\">&lt;amp-img></code>,<code class=\"language-text\">&lt;amp-carousel></code>, <code class=\"language-text\">&lt;amp-sidebar></code> 등 AMP 컴포넌트는 반드시 지정된 방식으로 스타일링해야 함.</li>\n<li>특히 layout=\"responsive\" 등 AMP layout 시스템에 맞는 설정 필수.</li>\n</ul>\n<hr>\n<h2>대망의 1차 배포 성공 🏰</h2>\n<p>검색 색인과 AMP 페이지 1차 반영 이후 구글 유입이 조금씩이나만 바로 잡혀가는 모습이 너무 보기 좋다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/1a42130ea77c5cf2baf51cc20188af56/3e86e/img_4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 88.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADLklEQVR42p1UTW/bRhDlT7QvRZE0cS4JUOfaNug/6D/opUAOAZJDe4iNoA2cIEYtxG2dyEbiOhIlW7IlRRLFb1KkKJLrlzdLKZaL9tIFBrM7O/t2ZmfeGvP5HCJZlmE5z/McRVFoPac9W5GlTzCN4TgORr6Hge9iEHiw4whGHMcQSZIEEfV0OoVljXHR72M0HmNKu4jsy572J1gyTZCmqbbJ3nA4hG3bMGQxsSyMRiNuxpjNZuh1LzDodBEygth1MRmPMBj1eZGFJE0Q+iEu7D6avRbssa2BLWsC23FhCEDn7Axv63X0hxajSXHeaKN3fIx4MEDESCfdLvoDAjJiAYyCCOd2D42eicALdISe5yMMoypCSSMKQ7h+xLSnmLkWXM9DwjdLshkipuUwHclCpxxFCMIpfUKCVSlHtIk2sDIuLy8rfWWo5D/Gqt/yrPEZRBsX5xcOarEXRzH29vZQq9Wwu7uLPp9Bhrp2dgVQKYWlLheiFNel0k5mq4UvbnyJ27c3sLa2hu3tbW3P2VoCE7EoHp9CAxZlTuPlvyakVKFnrVMT9+7dxf3NTXx18yZe7LyoIlTVhU3rHIe9ZgX45N0+npt17Jwc4Nm713j010u8umjgabOOx9x72fkbP/22hY07d3Fr4xbW19fxw8MfsdU5ws8n+3j8voYt8xA73Q9wEla51hiidtTGH38e46DexN6hid9Penj9YYD9xhiHnQl+fXWAb779Ht89eIDNza/x6JctHH10sd+in9nDm5aN+lmAOJ3BUGWBsiwWj6s+P+7/GXLWcMlF6T3hrmU77LkUc85n8xxZfiVSABHZK6SI8oYLKVjAnEEVZQkjKzKWX6EggEPG2Kyo3T7FpGXCabcpp7CaJtctWGYTE9NExgZXpGW5kDmp6Z11ea571YdFkcMlGzwROmlhxIHrwSeffa6XOmObKGkZRiSimIFHOk5sbxWwIB95OAg1jQJS0fcDroNqHpCrtMd8nphUXGVVwX5N0ph+wfUIw7ACE/1PCYLqE1gSQJNAIuRatHBaLroWoe/7+k+Um/Scv4dcsHqJAOs1Mwk51yxjUdJ5ykLO8AlVCUZdn4t4hAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='어서오세요 :)' title='' src='/static/1a42130ea77c5cf2baf51cc20188af56/ca1dc/img_4.png' srcset='/static/1a42130ea77c5cf2baf51cc20188af56/e7570/img_4.png 170w,\n/static/1a42130ea77c5cf2baf51cc20188af56/f46e7/img_4.png 340w,\n/static/1a42130ea77c5cf2baf51cc20188af56/ca1dc/img_4.png 680w,\n/static/1a42130ea77c5cf2baf51cc20188af56/02d09/img_4.png 1020w,\n/static/1a42130ea77c5cf2baf51cc20188af56/3e86e/img_4.png 1062w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>어서오세요 :)</figcaption>\n  </figure></p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/bc8f198356d8e141d2b27b481b73551b/926ba/img_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 43.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDklEQVR42o2Q30tTYRjHzx/QdXfRj5ugLqSboIsuogi6WBCRzILQJUiUddFFVGgkEiVEhUSW1kXuRjIiiyASnU2XplPMLWbK/NWmMje3nZ2d7Zzznk/vmau8KOj78uV9n+fl+T7f51ESY0FWB/0khob48TnAu9kgbyXfzIzROz9FWtPRdBNVN8j9B5Wo28XsiSMsHNqP33WAXS88bPfWsqW9kr1dF1kv5nBg2za/4byF2Lg35yWU6MmjRKtczB/ch+9wBVufnWZbp0cKnmJHZy2pgvp3wX9Aid9tIna7keSdW3x/0Iynv5VqXytn+x5y44sXzSz8EfwltBKDryPY0QgisYy9qYmi6joF05QJOUJRFheLYMjYMKBQKOfKLENoKmJ5CVJJyGYQlokl/52miq5pCKfBwgz2wHvETAgx3IcIBxEj/djfJhCRSUR8seRElPYnWTBIpFaYW53D1vKgF0suFVM6KY1jSke5HJaawUgnMbJpLEmRSZfcOmIOzXyewViICTXG8d4W9nRfpubTIy4EOphOx1AMOa6eV0mtxUlmk1jC2tiZPKZlUbQMxpfCTC2GQMYfIn6ar1fSfrWKY23nqOioZveTM+xscxOQjRSn+FVkgGu+pzT4n3M/2I03/LHEe2MvaRntwt3TRM3rJh5P9tDqbWa9roa18x6iV+oYb6hntPESwzfrSUen+Ql2QnIFsy2fmAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='google search console' title='' src='/static/bc8f198356d8e141d2b27b481b73551b/ca1dc/img_2.png' srcset='/static/bc8f198356d8e141d2b27b481b73551b/e7570/img_2.png 170w,\n/static/bc8f198356d8e141d2b27b481b73551b/f46e7/img_2.png 340w,\n/static/bc8f198356d8e141d2b27b481b73551b/ca1dc/img_2.png 680w,\n/static/bc8f198356d8e141d2b27b481b73551b/926ba/img_2.png 918w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>google search console</figcaption>\n  </figure></p>\n<p>구글 Search Console 에서 AMP 메뉴를 확인하니, Google Amp validator 검증에 실패해,<br>\n유효하지 않은 페이지로 판단해 노출하지 않은 모양이다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/b108428a3e21a2c5326ed17bbbe04178/6d612/img_5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 78.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9klEQVR42o2U546kMBCEef9XPO2dLuwEwpAMzu6rMvaInR+jtdQyOHyuLjc05teH6L6Tdhjk8XjIOI7S971M05TDWivfaimJ80Ea+/FDdHuXYQQAsLFEhSulvgWNMYixTpoAcnp7cMpxbIqitZYQQn733p/mAt6h0Ggj1piswjn3DIMxbqhQNo2xAco95jPQWQnYx1lrzaFQqe1LivTt7CPhFTitq/z8/QdjhwVh3yXAErZt22TfjTQbBgmY5/l5ETvGmBoXUXkFLjj87+flqTB6l4ONGWltpdFIecXJNJ9BCL169ZFtVbt8Xm8SihUBkICDJadsDyDJhFQgDSeA0HOwqW2X663FmgMYsTcWIPcZA+CGRfSPwbS7rpMBNcmgj+x5YE55VXK53fM6B5UE0kfqp2pNoMJiLqCPZwgP4HOFsc0A/rtcZeZlvQJDAVJhBVaV9ZLYn295UYfCpShMmIsol1RSzsAdHizL8vTx9ULOl6Kg5g5Lto1eR0m85VJCCfssDmimUi5nlex5CMf5zp5Fvu1abvcWVbGIh6Jo8NXo/StwhS8sG6ZG2dzIvj5zvH5iTGmal1xzuRrgWypzKcXyc0D9UF39zN61FZa0XS9qoUIvHna5fCkF6Lw0Ph4/h4D+XXh4xjrjJqbLdyrmGJ8DUjYuyH9qGOB5vnJoBAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='안되는 이유가 있지..' title='' src='/static/b108428a3e21a2c5326ed17bbbe04178/ca1dc/img_5.png' srcset='/static/b108428a3e21a2c5326ed17bbbe04178/e7570/img_5.png 170w,\n/static/b108428a3e21a2c5326ed17bbbe04178/f46e7/img_5.png 340w,\n/static/b108428a3e21a2c5326ed17bbbe04178/ca1dc/img_5.png 680w,\n/static/b108428a3e21a2c5326ed17bbbe04178/6d612/img_5.png 936w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>안되는 이유가 있지..</figcaption>\n  </figure></p>\n<p>누락된 허용하지 않은 태그, 미디어 속성의 태그에 src 가 https 가 아닌 http 가 존재하거나,<br>\n&#x3C;기사이름> 이런식의 태그가 아닌데 태그라고 오 인식하는 문제가 있었다.</p>\n<p>( 이미지 혹은 뷰어 용 태그에 src 는 https 가 아니라 http 로 되어있는 부분은 server 에서 처리가 필요 )</p>\n<blockquote>\n<p>이걸 어떻게 표준화 할까 ...?</p>\n</blockquote>\n<hr>\n<h2>🤔 라이브러리를 안 쓰고 처리 할 수 없었을까 ?</h2>\n<p>DOMParser 를 쓸 수 없었다.\n브라우저 런타임에서만 동작하는 Web API 이고, Next.js의 서버 사이드 코드(SSR), 즉 Node.js 환경에서는 사용할 수 없다.</p>\n<p>기사 본문은 <strong>서버 사이드 데이터 페칭</strong> 시점에 가져온다. 그래서 amp guide 에 맞는 dom 으로 변환하는 util 함수 내에,<br>\n기사 본문을 amp guide 에 맞는 정규식으로 치환하거나 제거하는 방식으로 진행했더니 너무 위험했다.</p>\n<p>(기사 본문 내용이 틀어지거나, inline Style 이 깨지거나 ... 보여야 할 내용이 일부분 사라지거나 ...)</p>\n<table>\n<thead>\n<tr>\n<th>작업 예시</th>\n<th>라이브러리 없이 가능?</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">&lt;img></code> -> <code class=\"language-text\">&lt;amp-img></code> 변환</td>\n<td>어려움</td>\n<td>HTML 구조 파싱이 필요, 정규식으론 불안정</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">&lt;iframe></code> -> <code class=\"language-text\">&lt;amp-iframe></code></td>\n<td>어려움</td>\n<td>조건 분기 및 속성 매핑 복잡</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">onClick</code>, <code class=\"language-text\">onMouseOver</code> 속성 제거</td>\n<td>가능하지만 복잡</td>\n<td>수백 개 태그 모두 순회해야 함</td>\n</tr>\n<tr>\n<td>불필요한 태그 제거 (<code class=\"language-text\">&lt;font></code>, <code class=\"language-text\">&lt;map></code>)</td>\n<td>가능하지만 비효율</td>\n<td>정규식 + 수작업으로 불안정</td>\n</tr>\n<tr>\n<td>최종 HTML 문자열로 재조립</td>\n<td>위험</td>\n<td>구조 깨질 확률 높음</td>\n</tr>\n</tbody>\n</table>\n<p>이 과정에서 여러 라이브러리를 도입했는데, 목표는 다음과 같았다.</p>\n<ul>\n<li>HTML 태그를 파싱해서 변형하거나 제거하는 작업이 필요하다.</li>\n<li>따라서, DOM을 조작할 수 있는 라이브러리가 필요하다.</li>\n</ul>\n<hr>\n<h2>라이브러리 도입 결정</h2>\n<p>cheerio — DOM 파싱의 사실상 업계 표준</p>\n<p>AMP 변환의 핵심은 Google GuideLine 에 허용되지 않는 HTML 태그를 파싱해서 변형하거나 제거하는 작업이 필연적인데,<br>\n이때 cheerio는 서버 사이드에서 jQuery처럼 HTML을 다룰 수 있는 경량 라이브러리로, 아래 작업들을 편하게 처리할 수 있었다.</p>\n<p>사용법은 아래 예시 로.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".writer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 불필요한 요소 제거</span>\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 이미지 태그 변환</span></code></pre></div>\n<blockquote>\n<p>대안은?<br>\njsdom도 있었지만, 성능과 문법의 직관성에서 cheerio가 더 낫다고 판단.</p>\n<ul>\n<li>( 훨씬 무겁고, DOM 구현이 브라우저 수준이지만, cheerio보다 느림 )</li>\n</ul>\n<p>단순한 조작에는 cheerio가 가장 적합하다.</p>\n</blockquote>\n<p>isTag (from domhandler) — 안정성 있는 노드 필터링</p>\n<p>모든 DOM 노드가 태그는 아니기 때문에, cheerio(\"*\").each(...) 루프를 돌릴 때는 노드 타입 검사를 해줘야 한다.<br>\n이때 isTag()를 사용하면 안정적으로 태그 여부를 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isTag</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 태그일 때만 속성 제거</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>image-size + fetch ⚠️</p>\n<p>별도 설치가 필요했던 라이브러리는 아니지만 안정성과 성능 사이의 고민이 존재했다.</p>\n<p>AMP에서는 <amp-img>에 반드시 width와 height가 있어야 한다.<br>\n그런데 컨텐츠에 이 정보가 누락된 경우도 있어서, 서버에서 이미지를 직접 fetch하고 image-size로 크기를 추출할 필요가 있었다.</p>\n<p>img 태그에 크기를 알 수 없는 경우 별도로 호출하기로 하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">arrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width<span class=\"token punctuation\">,</span> height <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">imageSize</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>이 방식은 어떤 이미지든 깨지지 않게 하려는 의도는 있으나, 단점도 존재한다.</p>\n<ul>\n<li>SSR 성능 저하 가능성 (네트워크 fetch + 버퍼 파싱)</li>\n<li>이미지 수가 많아질수록 병목 현상 발생</li>\n</ul>\n<blockquote>\n<p>그러나, 최근 기사 editor 에서 이미지 크기를 지정하는 경우가 대부분 이며,</p>\n<p>오래된 기사의 경우에만 이미지 크기가 표기 되어있지 않아 (width, height), 해당 이슈에 대해서 공유를 드렸다.</p>\n<p>이미지 의 크기를 알 수 없는 경우에만 코드레벨에서 조건을 분기하였다.<br>\n( 서버에서 이미지를 직접 fetch하고 image-size로 크기를 추출하는 방식 )</p>\n</blockquote>\n<hr>\n<h2>마무리</h2>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 1rem;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/fcc85181c5344c17605082697a2576aa/b1620/img_6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 80.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVR42p1Uy2oUQRTNT4iL/IOf4GcYfIBuBFd+gBuJSxUfuFPRhahZBbJNfARcCCr4AlEEx4UmcaaT7q7q6nrX8d6aaZ1MBxwsOH2r6lafus9aqJXBYG8btRQQQqIsK2hjEGJECAHeB5IRMfaRCNZ5VI35gwWhLAblNsq6wt7uLqqqglIK1poMozWcs0g4eHi6bB9hTYQxJRjroDVbluZGJFgX9hNW5HJDLjpP5hMMuWDo0LxQZsZl2VrsyAJbosC/RkxxDApAzEFIfZc5hjn4hESuxwl8DDkxTMCSdXPFUJCFwfus5J9mf5xeP/iyiTuf1vG+GOBD8R0/moJCFfouG8riUNfZstZbVFZh8+dHvPz1GYUW+Fpt4ZvYwZHH53D47hIW75/EoXvHcXTtAopWolEOpdRjwlbTDVri4quHuP5uDVfertL8EZbWL+P00xtYfr2Cs89v4dKbFZx5dhOnnlzDiY2rOEb68y9uo9QKkgkb/bdsOLMuZ8xCU/lwKSQujZDyfvTj8oi0ppBmHbmT59qSQXK6DunD1c7BnYal2DiSHbo9Q/G2lEDLktYtGTFT2FSDzuH/BntwQOt5ui2XTIxzgRPPPS6EQKttP8usKIpR7uO2bdE0Te5nlgwpZV53e35SZnyWW7ZHWNc1RqPR5FGw44PUjpoeBgbPO/A6TJqAH43+a0OEbNlwOMySycuyzHOW3bwD65mYCdlyPZOU3510x49Ync5vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='아... 영롱해' title='' src='/static/fcc85181c5344c17605082697a2576aa/ca1dc/img_6.png' srcset='/static/fcc85181c5344c17605082697a2576aa/e7570/img_6.png 170w,\n/static/fcc85181c5344c17605082697a2576aa/f46e7/img_6.png 340w,\n/static/fcc85181c5344c17605082697a2576aa/ca1dc/img_6.png 680w,\n/static/fcc85181c5344c17605082697a2576aa/02d09/img_6.png 1020w,\n/static/fcc85181c5344c17605082697a2576aa/b1620/img_6.png 1144w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>아... 영롱해</figcaption>\n  </figure></p>\n<p>AMP 페이지 는 성능과 사용자 경험을 고려할 때 여전히 유용한 기술이다.<br>\n정리하면 다음과 같다.</p>\n<ul>\n<li>Next.js에서 지원하는 기능이지만, 제약이 많아 사용하기 어려운 경우가 많다.\n<ul>\n<li>Guide 에 맞는 HTML 태그를 파싱하고 변형하는 정교한 작업이 필요하다. ( 물론 트레이드 오프는 있다. )</li>\n<li>이때 cheerio와 isTag를 사용하면 안정적으로 작업할 수 있다.</li>\n</ul>\n</li>\n<li>성능과 사용자 경험을 고려할 때 여전히 유용한 기술이다. ( 도메인 특성에 맞게 사용함이 핵심. )</li>\n<li>제약을 잘 이해하고, 필요한 라이브러리를 적절히 활용해야 한다.</li>\n</ul>","frontmatter":{"title":"🏗️ AMP 페이지 개발","date":"May 01, 2025","update":"May 01, 2024","tags":["front-end","performance","series"],"series":null},"fields":{"slug":"/phase2/"}},"seriesList":{"edges":[{"node":{"id":"157bc344-b416-5386-96b5-c8abcaaa04b1","fields":{"slug":"/deploy-strategy/"},"frontmatter":{"title":"배포전략"}}},{"node":{"id":"9ffe9bc1-affb-594e-835e-411f3a793a5a","fields":{"slug":"/cpu-bound-vs-io-bound/"},"frontmatter":{"title":"CPU Bound 와 IO Bound"}}},{"node":{"id":"57b20240-e6eb-5935-8501-3e6c67e74117","fields":{"slug":"/basic/"},"frontmatter":{"title":"코틀린의 현재와 미래"}}},{"node":{"id":"bb741bf1-7c1e-5b80-bb1a-14792a626e7f","fields":{"slug":"/coroutine/"},"frontmatter":{"title":"코 루틴"}}},{"node":{"id":"27dbdca2-3881-5505-8ab7-9ec45927fa02","fields":{"slug":"/basic/"},"frontmatter":{"title":"Redis"}}},{"node":{"id":"438d9589-dd16-5ed8-b45b-9f4a98acf02a","fields":{"slug":"/rag/"},"frontmatter":{"title":"Rag"}}},{"node":{"id":"949c21ae-8526-56ae-9f82-e1e9f517b13e","fields":{"slug":"/spring-ai/"},"frontmatter":{"title":"Ai. Spring AI 로 때워도 되나유? 1편"}}},{"node":{"id":"b9a90cce-fcd6-53ba-aa91-ef1e39152b15","fields":{"slug":"/phase1/"},"frontmatter":{"title":"🗞️ 한 달간의 뉴스 사이트 프론트 성능 최적화✨"}}},{"node":{"id":"1e90878c-3b63-5ee1-82dd-7c84ca638419","fields":{"slug":"/phase2/"},"frontmatter":{"title":"🏗️ AMP 페이지 개발"}}},{"node":{"id":"03510f8b-e65c-56a0-a96c-bc3935cc4600","fields":{"slug":"/phase3/"},"frontmatter":{"title":"퍼포먼스 최적화 를 향해 - 1부"}}},{"node":{"id":"720fdeea-fb60-5df7-a27a-47eba40a7300","fields":{"slug":"/phase4/"},"frontmatter":{"title":"퍼포먼스 최적화 를 향해 - 2부"}}},{"node":{"id":"50b5fb3c-da1f-5275-9401-02e0413fdf4e","fields":{"slug":"/resume/"},"frontmatter":{"title":"이력서"}}}]},"previous":{"fields":{"slug":"/phase1/"},"frontmatter":{"title":"🗞️ 한 달간의 뉴스 사이트 프론트 성능 최적화✨"}},"next":{"fields":{"slug":"/phase3/"},"frontmatter":{"title":"퍼포먼스 최적화 를 향해 - 1부"}}},"pageContext":{"id":"1e90878c-3b63-5ee1-82dd-7c84ca638419","series":null,"previousPostId":"b9a90cce-fcd6-53ba-aa91-ef1e39152b15","nextPostId":"03510f8b-e65c-56a0-a96c-bc3935cc4600"}},"staticQueryHashes":[],"slicesMap":{}}